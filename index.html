<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <style></style>
    </head>
<body>
    <svg></svg>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script>

        let width = 800, height = 800;

        let svg = d3.select("svg")
            .attr("viewBox", "0 0 " + width + " " + height)

        // Load external data
        Promise.all([d3.json("links-sample.json"), d3.json("cases-sample.json")]).then(data => {

        // Data preprocessing
        data[0].forEach(e => {
            e.source = e.infector;
            e.target = e.infectee;
        });

        console.log(data[0]); //links
        console.log(data[1]); //cases

        let node = svg.append("g")
            .attr("id", "nodes")
            .selectAll("circle")
            .data(data[1])
            .enter()
            .append("circle")
                .attr("r", 10)
                .style("fill", d=>genderColor(d.gender))
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        let simulation = d3.forceSimulation()
            .nodes(data[1])
            .force("charge", d3.forceManyBody().strength(-10))
            .force("collide", d3.forceCollide().strength(10).radius(20))
            .force("r", d3.forceRadial(200, width /2, height /2).strength(0.1))
            .alphaMin(0.1)
            .on("tick", d => {
                node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);
            });

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
        }

        function genderColor (gender){
            for (let i=0; i<=gender.length;i++){
                if (gender == "male"){
                    return "blue"
                }else{
                    return "pink"
                }
            }
        }
            
            
        
        })
        
    </script>

</body>
</html>